<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Controle - Projeto Vórtice</title>
    <style>
        body { background-color: #121212; color: #e0e0e0; font-family: Arial, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; text-align: center; }
        #container { padding: 40px; border-radius: 10px; background-color: #1e1e1e; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5); }
        h1 { color: #bb86fc; }
        button { background-color: #03dac6; color: #121212; border: none; padding: 15px 30px; font-size: 18px; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; }
        button:hover { background-color: #32f9e5; }
        button:disabled { background-color: #555; cursor: not-allowed; }
        #status { margin-top: 20px; font-size: 20px; min-height: 50px; }
    </style>
</head>
<body onload="checkStatus()">

    <div id="container">
        <h1>Painel de Controle - Projeto Vórtice</h1>
        <button id="startButton" onclick="startServer()">Ligar Servidor</button>
        <p id="status">Carregando status inicial...</p>
    </div>

    <script>
        // --- Configurações ---
        const API_URL_BASE = 'https://YOUR_API_ID.execute-api.YOUR_REGION.amazonaws.com';
        const START_URL = `${API_URL_BASE}/start-server`;
        const STATUS_URL = `${API_URL_BASE}/server-status`;
        let pollingInterval;
        // --------------------

        const statusElement = document.getElementById('status');
        const startButton = document.getElementById('startButton');

        async function checkStatus() {
            try {
                const response = await fetch(STATUS_URL);
                const data = await response.json();

                switch(data.status) {
                    case 'running':
                        statusElement.innerHTML = `Servidor online!<br><strong>Conecte-se em: ${data.ip}</strong>`;
                        statusElement.style.color = "#2ecc71";
                        startButton.disabled = true;
                        if (pollingInterval) clearInterval(pollingInterval);
                        break;
                    case 'stopped':
                        statusElement.textContent = "Servidor está offline.";
                        statusElement.style.color = "#e0e0e0";
                        startButton.disabled = false;
                        if (pollingInterval) clearInterval(pollingInterval);
                        break;
                    case 'pending':
                    case 'stopping':
                        statusElement.textContent = `Status: ${data.status}...`;
                        statusElement.style.color = "#f39c12";
                        startButton.disabled = true;
                        break;
                    default:
                        statusElement.textContent = "Não foi possível obter o status.";
                        statusElement.style.color = "#e74c3c";
                        if (pollingInterval) clearInterval(pollingInterval);
                }
            } catch (error) {
                console.error("Erro ao verificar status:", error);
                statusElement.textContent = "Erro de conexão ao verificar status.";
                statusElement.style.color = "#e74c3c";
                if (pollingInterval) clearInterval(pollingInterval);
            }
        }

        async function startServer() {
            startButton.disabled = true;
            statusElement.textContent = "Enviando comando de inicialização...";
            statusElement.style.color = "#f39c12";

            try {
                const response = await fetch(START_URL, { method: 'POST' });
                const data = await response.json();

                statusElement.textContent = data.message;
                pollingInterval = setInterval(checkStatus, 10000);
            } catch (error) {
                console.error("Erro ao iniciar servidor:", error);
                statusElement.textContent = "Erro ao enviar comando de início.";
                statusElement.style.color = "#e74c3c";
                startButton.disabled = false;
            }
        }
    </script>

</body>
</html>
